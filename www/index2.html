<!DOCTYPE html>
<html>
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
		<title>Techbrowser Powered Search</title>
		<link href="css/reset.css" rel="stylesheet" type="text/css"  />
		<link rel="stylesheet" href="css/index.css" type="text/css" />
		<link rel="stylesheet" type="text/css" href="http://ajax.googleapis.com/ajax/libs/jqueryui/1.7.1/themes/base/jquery-ui.css">
	</head>

	<body class="body">
		<!-- jquery -->    
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.2/jquery.min.js"></script>
		<script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8.5/jquery-ui.min.js"></script>
		
		<script type="component" source="inputBox" id="inputBox"></script>
		<script type="component" source="resultsList" id="resultsList"></script>
		
		<script src="./componentjs/component.js"></script>
		<script src="./componentjs/component-extend-emitter.js"></script>
		<script src="./appContext.js"></script>
		<script>
			Component.overrideCurrent();
			
			var _self = this;
			var animated = false;
			var normalizationTimeoutId = null;
			var appContext = new AppContext();
			
			this.inputBox.on("save", function(entry){
				appContext.saveEntry(entry.url, entry.tags, function(response){
					if(response != "OK")
						alert(response);
				})
			});
			
			this.inputBox.on("urlInput", function(terms){
				appContext.getTags(terms, function(response){
					if(response.length > 0)
						_self.inputBox.setEntryTags(response);
				});
			});
			
			this.inputBox.on("query", function(terms){
				appContext.query(terms, function(response){
					$("#resultsList").fadeOut("fast",function(){
						
						$("#resultsList").empty();
			        	if(response.length){
			        		if(normalizationTimeoutId)
			        			clearTimeout(normalizationTimeoutId);
			        		
			        		if(!animated) {
			        			$("#inputBox").animate({ 
								    top: "0%",
								    marginTop: "0px",
								  }, 
								  1500, 
								  function(){
								    	_self.inputBox.showAutosuggestBox();
								  });
								$("#resultsList").animate({ 
									marginTop: "0px"
								  }, 1500 );
								_self.inputBox.closeAutosuggestBox();
								animated = true;
			        		}
			        		
			        		
							var resultsList = $("#resultsList");
							for(var i=0;i<response.length;i++){
								resultsList[0].addItem(response[i]);
							}
							
							
						} else {
							normalizationTimeoutId = setTimeout(function(){
								if(animated) {
									$("#inputBox").animate({ 
									    top: "50%",
									    marginTop: "-221px"
									  }, 1500 );
									$("#resultsList").animate({ 
										marginTop: "221px"
									  }, 1500 );
									animated = false;
								}
							}, 2000);
						}
			        	
			        	$("#resultsList").fadeIn("fast");
					});
				});
			});
			
		</script>
	</body>
</html>
