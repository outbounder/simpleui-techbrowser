$(document).ready(function(){
	
	// add new entry functionality
	$("#addBtn").click(function(){
		var addDialog = Component.fromPath("component/add",null,false,true);
		SexyLightbox.initialize();
		SexyLightbox.showDOM(null,addDialog,500,200,true,"#000000");
		addDialog.dialog = SexyLightbox;
	});
	
	
	// autocomplete functionality
	$("#searchField").tagit({
		source: "http://api-techbrowser.appspot.com/suggest/search.jsonp",
		jsonp: true,
		param: 'q'
	});
	$("#searchField").bind("onchanged",function(){
		var term = $("#searchField")[0].getValue();
		$.getJSON("http://api-techbrowser.appspot.com/search.jsonp?q="+term+"&callback=?", function(response) {
			$("#resultsDiv").fadeOut("fast",function(){
				$("#resultsDiv").empty();
				console.log(response);
	        	if(response.length){
					var resultsDiv = $('#resultsDiv');
					for(var i=0;i<response.length;i++){
						// Creating a new result object and firing its toString method:
						resultsDiv.append(new result(response[i]) + '');
					}
				}
	        	$("#resultsDiv").fadeIn("fast");
			});
	    });
	});
	
	
	function result(r){
		
		// This is class definition. Object of this class are created for
		// each result. The markup is generated by the .toString() method.
		
		var arr = [];
		
		arr = [
			'<div class="webResult">',
			'<h2><a href="',r.url,'" target="_blank">',r.name,'</a></h2>',
			'<a href="',r.url,'" target="_blank">',r.ul,'</a>',
			'</div>'
		];
			
		
		// The toString method.
		this.toString = function(){
			return arr.join('');
		}
	}
});