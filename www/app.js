$(document).on("ready", function(){
	
	// autocompleter 
	new Autocompleter('s', {
		url: 'http://api-techbrowser.appspot.com/suggest/search.jsonp',
		param: 'q',
		jsonp: true,
		cache: false
		});
	
	$("searchForm").onSubmit(function(){
		var term = $("s").value();
		alert(term);
		Xhr.load("http://api-techbrowser.appspot.com/search.jsonp?q="+term, {
	        method:  "get",
	        jsonp: true,
	        onComplete: function(response) {
	        	var results = response.json;
	        	if(results.length){
					
					// If results were returned, add them to a pageContainer div,
					// after which append them to the #resultsDiv:
					
					var pageContainer = $('resultsDiv');
					
					for(var i=0;i<results.length;i++){
						// Creating a new result object and firing its toString method:
						pageContainer.append(new result(results[i]) + '');
					}
				}
	        }
	    });
		
		return false;
	});
	
	function result(r){
		
		// This is class definition. Object of this class are created for
		// each result. The markup is generated by the .toString() method.
		
		var arr = [];
		
		arr = [
			'<div class="webResult">',
			'<h2><a href="',r.url,'" target="_blank">',r.name,'</a></h2>',
			'<a href="',r.url,'" target="_blank">',r.ul,'</a>',
			'</div>'
		];
			
		
		// The toString method.
		this.toString = function(){
			return arr.join('');
		}
	}
});